# A2UI SDK æŠ€æœ¯è®¾è®¡æ–¹æ¡ˆ

> åŸºäº Google A2UI v0.8 åè®®çš„ React SDK æŠ€æœ¯è®¾è®¡

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| ç‰ˆæœ¬ | 1.0 |
| åˆ›å»ºæ—¥æœŸ | 2025-12-25 |
| A2UI åè®®ç‰ˆæœ¬ | v0.8 (Stable) |
| ç›®æ ‡æ¡†æ¶ | React 18+ / TypeScript 5+ |
| ä¾èµ– | Radix UI (å¯é€‰) |

---

## 0. A2UI åè®®æ¦‚è¿°

### 0.1 ä»€ä¹ˆæ˜¯ A2UIï¼Ÿ

**A2UIï¼ˆAgent-to-User Interfaceï¼‰** æ˜¯ Google äº 2025 å¹´ 12 æœˆå¼€æºçš„ä¸€å¥—**é¢å‘ AI Agent çš„ç•Œé¢åè®®/è§„èŒƒ**ï¼Œç”¨æ¥è§£å†³ã€ŒAgent ä¸æ˜¯åªå›ä¸€ä¸²æ–‡æœ¬ï¼Œè€Œæ˜¯èƒ½å®‰å…¨åœ° "è¯´" å‡ºä¸€ä¸ªå¯äº¤äº’ UIã€çš„é—®é¢˜ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        A2UI: Agent â†’ UI Blueprint                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   ä¼ ç»Ÿæ¨¡å¼:                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      çº¯æ–‡æœ¬         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚   Agent    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   å‰ç«¯     â”‚  â†’ æ‰‹å†™ UI è§£æé€»è¾‘      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                              â”‚
â”‚   A2UI æ¨¡å¼:                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   UI å£°æ˜ JSON      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚   Agent    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   å‰ç«¯     â”‚  â†’ é€šç”¨ Renderer æ¸²æŸ“    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   (ç»„ä»¶+å¸ƒå±€+ç»‘å®š)    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 0.2 æ ¸å¿ƒæ¦‚å¿µ

#### å£°æ˜å¼ UI è§„èŒƒ

A2UI æ˜¯ä¸€ç§**å£°æ˜å¼ UI è§„èŒƒ**ï¼šAgent ä¸ç›´æ¥å†™ React/Vue ä»£ç ï¼Œè€Œæ˜¯ç”¨ **JSON æè¿°** "æœ‰å“ªå‡ ä¸ªç»„ä»¶ã€æ€ä¹ˆå¸ƒå±€ã€æœ‰å“ªäº›äº¤äº’å’Œæ•°æ®ç»‘å®š"ã€‚å‰ç«¯å®¢æˆ·ç«¯å†æŠŠè¿™ä»½ JSON æ˜ å°„åˆ°è‡ªå·±æœ¬åœ°çš„ç»„ä»¶åº“æ¥æ¸²æŸ“çœŸå®ç•Œé¢ã€‚

```json
// Agent è¾“å‡ºçš„ A2UI JSONï¼ˆUI è“å›¾ï¼‰
{
  "surfaceUpdate": {
    "components": [
      { "id": "root", "component": { "Column": { "children": { "explicitList": ["title", "form"] } } } },
      { "id": "title", "component": { "Text": { "text": { "literalString": "é¢„è®¢è¡¨å•" }, "usageHint": "h2" } } },
      { "id": "form", "component": { "Card": { "child": "form_content" } } }
    ]
  }
}
```

#### Agent é©±åŠ¨ç•Œé¢

A2UI ä¸»è¦é¢å‘ **Agent é©±åŠ¨ç•Œé¢** åœºæ™¯ï¼Œæ¯”å¦‚ï¼š
- èŠå¤©æœºå™¨äººé‡ŒåŠ¨æ€ç”Ÿæˆ**è¡¨å•**
- è‡ªé€‚åº”çš„**å¡ç‰‡åˆ—è¡¨**
- æ•°æ®å¯è§†åŒ–**å›¾è¡¨**
- å¤šæ­¥éª¤**å‘å¯¼æµç¨‹**

ä¸å†å±€é™äºçº¯æ–‡æœ¬é—®ç­”ï¼Œè€Œæ˜¯è®© Agent èƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡ã€Œæ™ºèƒ½ã€åœ°é€‰æ‹©æœ€åˆé€‚çš„äº¤äº’æ–¹å¼ã€‚

### 0.3 è§£å†³çš„æ ¸å¿ƒé—®é¢˜

| é—®é¢˜ | A2UI è§£å†³æ–¹æ¡ˆ |
|------|---------------|
| **å®‰å…¨æ€§** | Agent åªèƒ½è¾“å‡º**ç™½åå•ç»„ä»¶**æè¿°ï¼Œä¸èƒ½æ“ä½œ DOM æˆ–æ‰§è¡Œä»»æ„è„šæœ¬ï¼Œå‰ç«¯ä¿ç•™æœ€ç»ˆæ§åˆ¶æƒ |
| **è·¨ç«¯ & è·¨æ¡†æ¶** | åŒä¸€ä»½ A2UI JSONï¼Œå¯åœ¨ Web/Android/iOS ç­‰ä¸åŒç«¯ï¼Œç”±å„è‡ª Renderer ç”¨åŸç”Ÿç»„ä»¶æ¸²æŸ“ |
| **æµå¼ UI ç”Ÿæˆ** | æ”¯æŒ JSONL å¢é‡æ¶ˆæ¯ï¼ŒAgent è¾¹æ€è€ƒè¾¹ã€Œé•¿å‡ºã€ç•Œé¢ï¼Œå‰ç«¯è¾¹æ”¶è¾¹æ¸²æŸ“ |
| **æ•°æ®ç»‘å®š** | å£°æ˜å¼æ•°æ®ç»‘å®š + å¢é‡æ›´æ–°ï¼ŒUI ä¸æ•°æ®è‡ªåŠ¨åŒæ­¥ |

### 0.4 ä¸å‰ç«¯/Agent çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        A2UI åœ¨ç³»ç»Ÿä¸­çš„ä½ç½®                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                           Agent (åç«¯)                              â”‚     â”‚
â”‚  â”‚  â€¢ ç†è§£ç”¨æˆ·æ„å›¾                                                      â”‚     â”‚
â”‚  â”‚  â€¢ å†³å®šå±•ç¤ºä»€ä¹ˆ UI                                                   â”‚     â”‚
â”‚  â”‚  â€¢ ç”¨ A2UI åè®®è¾“å‡ºã€ŒUI è“å›¾ã€(ç»“æ„ + ç»„ä»¶ + äº¤äº’æ„å›¾)                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â”‚ A2UI JSON (JSONL Stream)                 â”‚
â”‚                                  â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                           å‰ç«¯ (Client)                             â”‚     â”‚
â”‚  â”‚  â€¢ æŠŠã€ŒUI è“å›¾ã€ç¿»è¯‘æˆæœ¬åœ°ç»„ä»¶æ ‘                                      â”‚     â”‚
â”‚  â”‚  â€¢ è´Ÿè´£å…·ä½“æ¸²æŸ“ã€æ ·å¼ã€å¯è®¿é—®æ€§                                       â”‚     â”‚
â”‚  â”‚  â€¢ ä¿ç•™æƒé™æ§åˆ¶å’Œå®‰å…¨è¾¹ç•Œ                                             â”‚     â”‚
â”‚  â”‚  â€¢ ä¸ŠæŠ¥ç”¨æˆ·äº¤äº’ (userAction)                                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 0.5 ä¸å…¶ä»–åè®®çš„å…³ç³»

A2UI é€šå¸¸ä¼šå’Œå…¶å®ƒ Agentic åè®®ä¸€èµ·ä½¿ç”¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Agentic Protocol Stack                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                            A2A (Google)                              â”‚   â”‚
â”‚   â”‚             Agent â†” Agent ä¹‹é—´çš„é€šä¿¡åè®®                              â”‚   â”‚
â”‚   â”‚             è§£å†³: å¤š Agent åä½œã€ä»»åŠ¡å§”æ‰˜                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                            AG-UI (CopilotKit)                         â”‚ â”‚
â”‚   â”‚             Agent â†” å‰ç«¯ ä¹‹é—´çš„æ¶ˆæ¯/äº‹ä»¶é€šé“                          â”‚ â”‚
â”‚   â”‚             è§£å†³: SSE è¿æ¥ã€äº‹ä»¶è·¯ç”±ã€çŠ¶æ€åŒæ­¥                        â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                         â˜… A2UI (Google) â˜…                            â”‚ â”‚
â”‚   â”‚             ä¸“é—¨ç®¡ã€Œç•Œé¢è¿™å±‚é•¿ä»€ä¹ˆæ ·ã€                                 â”‚ â”‚
â”‚   â”‚             è§£å†³: ç»„ä»¶æè¿°ã€å¸ƒå±€å£°æ˜ã€æ•°æ®ç»‘å®šã€äº¤äº’å®šä¹‰               â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                            MCP (Anthropic)                            â”‚ â”‚
â”‚   â”‚             Agent â†” å·¥å…·/æ•°æ®æº ä¹‹é—´çš„åè®®                            â”‚ â”‚
â”‚   â”‚             è§£å†³: å·¥å…·è°ƒç”¨ã€å¤–éƒ¨èµ„æºè®¿é—®                               â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åè®®åˆ†å·¥æ€»ç»“ï¼š**

| åè®® | å‘èµ·æ–¹ | å…³æ³¨ç‚¹ | è§£å†³é—®é¢˜ |
|------|--------|--------|----------|
| **A2A** | Google | Agent â†” Agent | å¤šæ™ºèƒ½ä½“åä½œé€šä¿¡ |
| **AG-UI** | CopilotKit | Agent â†” å‰ç«¯ï¼ˆä¼ è¾“å±‚ï¼‰ | SSE äº‹ä»¶æµã€çŠ¶æ€åŒæ­¥ |
| **A2UI** | Google | Agent â†” å‰ç«¯ï¼ˆå†…å®¹å±‚ï¼‰ | UI ç»„ä»¶æè¿°ã€æ¸²æŸ“ |
| **MCP** | Anthropic | Agent â†” å·¥å…· | å¤–éƒ¨å·¥å…·è°ƒç”¨ |

### 0.6 A2UI æ ¸å¿ƒæ¶ˆæ¯ç±»å‹

| æ¶ˆæ¯ç±»å‹ | æ–¹å‘ | ä½œç”¨ |
|----------|------|------|
| `surfaceUpdate` | Server â†’ Client | å‘é€ç»„ä»¶æ ‘æè¿°ï¼ˆé‚»æ¥è¡¨æ¨¡å‹ï¼‰ |
| `dataModelUpdate` | Server â†’ Client | æ›´æ–°æ•°æ®æ¨¡å‹ï¼ˆæ”¯æŒæ•°æ®ç»‘å®šï¼‰ |
| `beginRendering` | Server â†’ Client | é€šçŸ¥å®¢æˆ·ç«¯å¼€å§‹æ¸²æŸ“ |
| `deleteSurface` | Server â†’ Client | åˆ é™¤æŒ‡å®š UI åŒºåŸŸ |
| `userAction` | Client â†’ Server | ä¸ŠæŠ¥ç”¨æˆ·äº¤äº’äº‹ä»¶ |

### 0.7 å®˜æ–¹èµ„æº

| èµ„æº | é“¾æ¥ |
|------|------|
| GitHub | [github.com/google/A2UI](https://github.com/google/A2UI) |
| å®˜ç½‘ | [a2ui.org](https://a2ui.org/) |
| è§„èŒƒæ–‡æ¡£ | [a2ui.org/specification/v0.8-a2ui/](https://a2ui.org/specification/v0.8-a2ui/) |
| CopilotKit é›†æˆ | [copilotkit.ai/blog/a2ui-ag-ui](https://www.copilotkit.ai/blog/build-with-googles-new-a2ui-spec-agent-user-interfaces-with-a2ui-ag-ui) |

---

## 1. è®¾è®¡ç›®æ ‡

### 1.1 æ ¸å¿ƒç›®æ ‡

| ç›®æ ‡ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **åè®®å®Œæ•´æ€§** | 100% è¦†ç›– A2UI v0.8 è§„èŒƒ | P0 |
| **å¼€å‘ä½“éªŒ** | æä¾› React Hooks + ç»„ä»¶ï¼Œ5 åˆ†é’Ÿä¸Šæ‰‹ | P0 |
| **å¯æ‰©å±•æ€§** | æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶ç›®å½•ã€è‡ªå®šä¹‰æ¸²æŸ“å™¨ | P1 |
| **ç±»å‹å®‰å…¨** | å®Œæ•´ TypeScript ç±»å‹å®šä¹‰ | P1 |
| **æ€§èƒ½** | æ”¯æŒæµå¼æ¸²æŸ“ã€å¢é‡æ›´æ–°ã€è™šæ‹ŸåŒ– | P2 |

### 1.2 éç›®æ ‡

- ä¸å®ç° A2UI Serverï¼ˆåç«¯ Agent ç”Ÿæˆ A2UIï¼‰
- ä¸å®ç° A2A Transportï¼ˆä½¿ç”¨ç°æœ‰ AG-UI SSEï¼‰
- ä¸å®ç°å®Œæ•´ Flutter/iOS/Android Renderer

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 å±‚æ¬¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Application Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  <A2uiSurface />  <A2uiProvider />  useA2ui()  useA2uiStream()      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              Component Layer                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ComponentRegistry    A2uiComponentRenderer    Standard Catalog       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              Engine Layer                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  A2uiEngine    SurfaceManager    DataModelStore    BindingResolver   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              Protocol Layer                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  A2uiMessageParser    A2uiMessageTypes    A2uiEventRouter            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              Transport Layer                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SSE Connection (AG-UI)    WebSocket (å¯é€‰)    Direct Feed (æµ‹è¯•)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   @aevatar/    â”‚
â”‚   kit-a2ui     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   (NEW)        â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
        â”‚                                                 â”‚
        â”‚ depends                                         â”‚
        â–¼                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚   @aevatar/    â”‚     â”‚   @aevatar/    â”‚     â”‚   @aevatar/    â”‚
â”‚   kit-types    â”‚â—„â”€â”€â”€â”€â”‚   kit-protocol â”‚     â”‚   kit-react    â”‚
â”‚   (æ‰©å±•)       â”‚     â”‚   (æ‰©å±•)       â”‚     â”‚   (æ‰©å±•)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 åŒ…ç»“æ„è®¾è®¡

```
packages/
â”œâ”€â”€ kit-types/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ agui.ts           # ç°æœ‰ AG-UI ç±»å‹
â”‚       â””â”€â”€ a2ui.ts           # ğŸ†• A2UI ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ kit-protocol/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ extensions/
â”‚       â”‚   â”œâ”€â”€ index.ts
â”‚       â”‚   â”œâ”€â”€ progress.ts   # ç°æœ‰æ‰©å±•
â”‚       â”‚   â””â”€â”€ a2ui.ts       # ğŸ†• A2UI äº‹ä»¶è§£æ
â”‚       â””â”€â”€ router.ts         # æ‰©å±•æ”¯æŒ A2UI è·¯ç”±
â”‚
â”œâ”€â”€ kit-a2ui/                  # ğŸ†• æ–°å¢åŒ…
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ engine/
â”‚       â”‚   â”œâ”€â”€ A2uiEngine.ts
â”‚       â”‚   â”œâ”€â”€ SurfaceManager.ts
â”‚       â”‚   â””â”€â”€ types.ts
â”‚       â”œâ”€â”€ data/
â”‚       â”‚   â”œâ”€â”€ DataModelStore.ts
â”‚       â”‚   â”œâ”€â”€ BindingResolver.ts
â”‚       â”‚   â””â”€â”€ PathUtils.ts
â”‚       â”œâ”€â”€ registry/
â”‚       â”‚   â”œâ”€â”€ ComponentRegistry.ts
â”‚       â”‚   â””â”€â”€ types.ts
â”‚       â””â”€â”€ parser/
â”‚           â”œâ”€â”€ MessageParser.ts
â”‚           â””â”€â”€ Validator.ts
â”‚
â””â”€â”€ kit-react/
    â””â”€â”€ src/
        â”œâ”€â”€ components/
        â”‚   â””â”€â”€ a2ui/          # ğŸ†• A2UI React ç»„ä»¶
        â”‚       â”œâ”€â”€ A2uiSurface.tsx
        â”‚       â”œâ”€â”€ A2uiComponentRenderer.tsx
        â”‚       â”œâ”€â”€ A2uiProvider.tsx
        â”‚       â””â”€â”€ catalog/
        â”‚           â”œâ”€â”€ index.ts
        â”‚           â”œâ”€â”€ layout/
        â”‚           â”œâ”€â”€ content/
        â”‚           â””â”€â”€ input/
        â”œâ”€â”€ hooks/
        â”‚   â”œâ”€â”€ useA2ui.ts     # ğŸ†•
        â”‚   â””â”€â”€ useA2uiStream.ts # ğŸ†•
        â””â”€â”€ context/
            â””â”€â”€ A2uiContext.ts  # ğŸ†•
```

---

## 3. Protocol Layer è®¾è®¡

### 3.1 A2UI æ¶ˆæ¯ç±»å‹å®šä¹‰

```typescript
// packages/kit-types/src/a2ui.ts

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// A2UI Protocol v0.8 - TypeScript Type Definitions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Server â†’ Client Messages
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * A2UI æœåŠ¡ç«¯æ¶ˆæ¯è”åˆç±»å‹
 */
export type A2uiServerMessage =
  | { surfaceUpdate: A2uiSurfaceUpdate }
  | { dataModelUpdate: A2uiDataModelUpdate }
  | { beginRendering: A2uiBeginRendering }
  | { deleteSurface: A2uiDeleteSurface };

/**
 * ç»„ä»¶æ ‘æ›´æ–°æ¶ˆæ¯
 */
export interface A2uiSurfaceUpdate {
  /** Surface æ ‡è¯†ç¬¦ï¼Œé»˜è®¤ 'default' */
  surfaceId?: string;
  /** ç»„ä»¶å®ä¾‹åˆ—è¡¨ï¼ˆé‚»æ¥è¡¨æ¨¡å‹ï¼‰ */
  components: A2uiComponentInstance[];
}

/**
 * ç»„ä»¶å®ä¾‹å®šä¹‰
 */
export interface A2uiComponentInstance {
  /** ç»„ä»¶å”¯ä¸€ IDï¼Œç”¨äºçˆ¶å­å¼•ç”¨ */
  id: string;
  /** ç»„ä»¶ç±»å‹åŠå±æ€§ï¼Œkey ä¸ºç»„ä»¶ç±»å‹å */
  component: A2uiComponentDefinition;
}

/**
 * ç»„ä»¶å®šä¹‰ï¼ˆåŠ¨æ€ç±»å‹ï¼‰
 * 
 * @example
 * { "Text": { "text": { "literalString": "Hello" } } }
 * { "Row": { "children": { "explicitList": ["child1", "child2"] } } }
 */
export type A2uiComponentDefinition = {
  [componentType: string]: A2uiComponentProps;
};

/**
 * ç»„ä»¶å±æ€§ï¼ˆåŠ¨æ€ç»“æ„ï¼‰
 */
export interface A2uiComponentProps {
  /** å•ä¸ªå­ç»„ä»¶ ID */
  child?: string;
  /** å¤šä¸ªå­ç»„ä»¶ */
  children?: A2uiChildren;
  /** ç”¨æˆ·äº¤äº’åŠ¨ä½œ */
  action?: A2uiAction;
  /** å…¶ä»–å±æ€§ï¼ˆæ•°æ®ç»‘å®šæˆ–å­—é¢å€¼ï¼‰ */
  [key: string]: A2uiBoundValue | A2uiChildren | A2uiAction | string | undefined;
}

/**
 * æ•°æ®æ¨¡å‹æ›´æ–°æ¶ˆæ¯
 */
export interface A2uiDataModelUpdate {
  /** Surface æ ‡è¯†ç¬¦ */
  surfaceId?: string;
  /** æ›´æ–°è·¯å¾„ï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæ ¹è·¯å¾„ */
  path?: string;
  /** æ•°æ®æ¡ç›®åˆ—è¡¨ï¼ˆé‚»æ¥è¡¨æ¨¡å‹ï¼‰ */
  contents: A2uiDataEntry[];
}

/**
 * æ•°æ®æ¡ç›®
 */
export interface A2uiDataEntry {
  /** é”®å */
  key: string;
  /** å­—ç¬¦ä¸²å€¼ */
  valueString?: string;
  /** æ•°å­—å€¼ */
  valueNumber?: number;
  /** å¸ƒå°”å€¼ */
  valueBoolean?: boolean;
  /** åµŒå¥—å¯¹è±¡ï¼ˆé‚»æ¥è¡¨ï¼‰ */
  valueMap?: A2uiDataEntry[];
  /** æ•°ç»„å€¼ */
  valueArray?: unknown[];
}

/**
 * å¼€å§‹æ¸²æŸ“ä¿¡å·
 */
export interface A2uiBeginRendering {
  /** Surface æ ‡è¯†ç¬¦ */
  surfaceId?: string;
  /** æ ¹ç»„ä»¶ ID */
  root: string;
  /** ç»„ä»¶ç›®å½• IDï¼ˆå¯é€‰ï¼‰ */
  catalogId?: string;
  /** å…¨å±€æ ·å¼ï¼ˆå¯é€‰ï¼‰ */
  styles?: Record<string, unknown>;
}

/**
 * åˆ é™¤ Surface æ¶ˆæ¯
 */
export interface A2uiDeleteSurface {
  /** è¦åˆ é™¤çš„ Surface ID */
  surfaceId: string;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Data Binding Types
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * æ•°æ®ç»‘å®šå€¼
 * 
 * @example
 * // å­—é¢å€¼
 * { "literalString": "Hello World" }
 * 
 * // è·¯å¾„ç»‘å®š
 * { "path": "/user/name" }
 * 
 * // å¸¦é»˜è®¤å€¼çš„ç»‘å®š
 * { "path": "/user/name", "literalString": "Guest" }
 */
export interface A2uiBoundValue {
  /** å­—ç¬¦ä¸²å­—é¢å€¼ */
  literalString?: string;
  /** æ•°å­—å­—é¢å€¼ */
  literalNumber?: number;
  /** å¸ƒå°”å­—é¢å€¼ */
  literalBoolean?: boolean;
  /** æ•°ç»„å­—é¢å€¼ */
  literalArray?: unknown[];
  /** æ•°æ®æ¨¡å‹è·¯å¾„ï¼ˆä»¥ / å¼€å¤´ï¼‰ */
  path?: string;
}

/**
 * å­ç»„ä»¶å®šä¹‰
 */
export interface A2uiChildren {
  /** æ˜¾å¼å­ç»„ä»¶ ID åˆ—è¡¨ */
  explicitList?: string[];
  /** åŠ¨æ€åˆ—è¡¨æ¨¡æ¿ */
  template?: A2uiTemplate;
}

/**
 * åˆ—è¡¨æ¨¡æ¿å®šä¹‰
 */
export interface A2uiTemplate {
  /** æ•°æ®æºè·¯å¾„ */
  dataBinding: string;
  /** æ¨¡æ¿ç»„ä»¶ ID */
  componentId: string;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Action Types
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * ç”¨æˆ·äº¤äº’åŠ¨ä½œå®šä¹‰
 */
export interface A2uiAction {
  /** åŠ¨ä½œåç§° */
  name: string;
  /** åŠ¨ä½œä¸Šä¸‹æ–‡ï¼ˆæºå¸¦æ•°æ®ï¼‰ */
  context?: A2uiActionContextItem[];
}

/**
 * åŠ¨ä½œä¸Šä¸‹æ–‡æ¡ç›®
 */
export interface A2uiActionContextItem {
  /** ä¸Šä¸‹æ–‡é”® */
  key: string;
  /** ä¸Šä¸‹æ–‡å€¼ï¼ˆæ”¯æŒæ•°æ®ç»‘å®šï¼‰ */
  value: A2uiBoundValue;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Client â†’ Server Messages
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * å®¢æˆ·ç«¯æ¶ˆæ¯è”åˆç±»å‹
 */
export type A2uiClientMessage =
  | { userAction: A2uiUserAction }
  | { error: A2uiClientError };

/**
 * ç”¨æˆ·æ“ä½œä¸ŠæŠ¥
 */
export interface A2uiUserAction {
  /** åŠ¨ä½œåç§° */
  name: string;
  /** æ¥æº Surface ID */
  surfaceId: string;
  /** è§¦å‘ç»„ä»¶ ID */
  sourceComponentId: string;
  /** æ—¶é—´æˆ³ (ISO 8601) */
  timestamp: string;
  /** è§£æåçš„ä¸Šä¸‹æ–‡æ•°æ® */
  context: Record<string, unknown>;
}

/**
 * å®¢æˆ·ç«¯é”™è¯¯ä¸ŠæŠ¥
 */
export interface A2uiClientError {
  /** é”™è¯¯ç  */
  code: string;
  /** é”™è¯¯æ¶ˆæ¯ */
  message: string;
  /** å…³è” Surface ID */
  surfaceId?: string;
  /** å…³è”ç»„ä»¶ ID */
  componentId?: string;
  /** é¢å¤–è¯¦æƒ… */
  details?: Record<string, unknown>;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Type Guards
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export function isSurfaceUpdate(msg: A2uiServerMessage): msg is { surfaceUpdate: A2uiSurfaceUpdate } {
  return 'surfaceUpdate' in msg;
}

export function isDataModelUpdate(msg: A2uiServerMessage): msg is { dataModelUpdate: A2uiDataModelUpdate } {
  return 'dataModelUpdate' in msg;
}

export function isBeginRendering(msg: A2uiServerMessage): msg is { beginRendering: A2uiBeginRendering } {
  return 'beginRendering' in msg;
}

export function isDeleteSurface(msg: A2uiServerMessage): msg is { deleteSurface: A2uiDeleteSurface } {
  return 'deleteSurface' in msg;
}

export function isBoundValue(value: unknown): value is A2uiBoundValue {
  if (!value || typeof value !== 'object') return false;
  const v = value as Record<string, unknown>;
  return 'literalString' in v || 'literalNumber' in v || 
         'literalBoolean' in v || 'literalArray' in v || 'path' in v;
}
```

### 3.2 æ¶ˆæ¯è§£æå™¨

```typescript
// packages/kit-protocol/src/extensions/a2ui.ts

import type {
  A2uiServerMessage,
  A2uiSurfaceUpdate,
  A2uiDataModelUpdate,
  A2uiBeginRendering,
  A2uiDeleteSurface,
} from '@aevatar/kit-types';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// A2UI Event Names (AG-UI CUSTOM äº‹ä»¶å)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export const A2UI_EVENT_NAMES = {
  SURFACE_UPDATE: 'a2ui.surface_update',
  DATA_MODEL_UPDATE: 'a2ui.data_model_update',
  BEGIN_RENDERING: 'a2ui.begin_rendering',
  DELETE_SURFACE: 'a2ui.delete_surface',
} as const;

export type A2uiEventName = typeof A2UI_EVENT_NAMES[keyof typeof A2UI_EVENT_NAMES];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Parsed Message Type
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export type A2uiParsedMessage =
  | { type: 'surface_update'; payload: A2uiSurfaceUpdate }
  | { type: 'data_model_update'; payload: A2uiDataModelUpdate }
  | { type: 'begin_rendering'; payload: A2uiBeginRendering }
  | { type: 'delete_surface'; payload: A2uiDeleteSurface };

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Parser
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * è§£æ A2UI JSONL æ¶ˆæ¯
 * 
 * @param input - JSON å­—ç¬¦ä¸²æˆ–å·²è§£æå¯¹è±¡
 * @returns è§£æåçš„æ¶ˆæ¯ï¼Œæ— æ•ˆè¿”å› null
 */
export function parseA2uiMessage(input: string | object): A2uiParsedMessage | null {
  try {
    const data = typeof input === 'string' ? JSON.parse(input) : input;

    if (data.surfaceUpdate) {
      return { type: 'surface_update', payload: data.surfaceUpdate };
    }
    if (data.dataModelUpdate) {
      return { type: 'data_model_update', payload: data.dataModelUpdate };
    }
    if (data.beginRendering) {
      return { type: 'begin_rendering', payload: data.beginRendering };
    }
    if (data.deleteSurface) {
      return { type: 'delete_surface', payload: data.deleteSurface };
    }

    return null;
  } catch {
    return null;
  }
}

/**
 * ä» AG-UI CUSTOM äº‹ä»¶æå– A2UI æ¶ˆæ¯
 */
export function parseA2uiFromCustomEvent(customEvent: {
  name: string;
  value: unknown;
}): A2uiParsedMessage | null {
  if (!customEvent.name.startsWith('a2ui.')) {
    return null;
  }
  return parseA2uiMessage(customEvent.value as object);
}

/**
 * è§£æ JSONL æµï¼ˆå¤šè¡Œï¼‰
 */
export function* parseA2uiJsonl(jsonl: string): Generator<A2uiParsedMessage> {
  for (const line of jsonl.split('\n')) {
    const trimmed = line.trim();
    if (!trimmed) continue;
    
    const parsed = parseA2uiMessage(trimmed);
    if (parsed) {
      yield parsed;
    }
  }
}
```

---

## 4. Engine Layer è®¾è®¡

### 4.1 A2uiEngine æ ¸å¿ƒå¼•æ“

```typescript
// packages/kit-a2ui/src/engine/A2uiEngine.ts

import { SurfaceManager, type Surface } from './SurfaceManager';
import { parseA2uiMessage, type A2uiParsedMessage } from '../parser/MessageParser';
import type { A2uiUserAction } from '@aevatar/kit-types';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Types
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export interface A2uiEngineOptions {
  /** Surface å°±ç»ªå›è°ƒ */
  onSurfaceReady?: (surfaceId: string, rootId: string) => void;
  /** Surface æ›´æ–°å›è°ƒ */
  onSurfaceUpdate?: (surfaceId: string) => void;
  /** Surface åˆ é™¤å›è°ƒ */
  onSurfaceDelete?: (surfaceId: string) => void;
  /** é”™è¯¯å¤„ç† */
  onError?: (error: A2uiEngineError) => void;
}

export interface A2uiEngineError {
  code: 'PARSE_ERROR' | 'COMPONENT_NOT_FOUND' | 'BINDING_ERROR' | 'UNKNOWN';
  message: string;
  surfaceId?: string;
  details?: unknown;
}

export type A2uiEngineListener = () => void;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Engine Implementation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export class A2uiEngine {
  private surfaceManager = new SurfaceManager();
  private listeners = new Set<A2uiEngineListener>();
  private options: A2uiEngineOptions;

  constructor(options: A2uiEngineOptions = {}) {
    this.options = options;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Message Processing
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * å¤„ç†å•æ¡ A2UI æ¶ˆæ¯
   */
  processMessage(message: A2uiParsedMessage): void {
    switch (message.type) {
      case 'surface_update':
        this.handleSurfaceUpdate(message.payload);
        break;
      case 'data_model_update':
        this.handleDataModelUpdate(message.payload);
        break;
      case 'begin_rendering':
        this.handleBeginRendering(message.payload);
        break;
      case 'delete_surface':
        this.handleDeleteSurface(message.payload);
        break;
    }
  }

  /**
   * å¤„ç† JSONL æ–‡æœ¬ï¼ˆæ”¯æŒå¤šè¡Œï¼‰
   */
  processJsonl(jsonl: string): void {
    for (const line of jsonl.split('\n')) {
      const trimmed = line.trim();
      if (!trimmed) continue;

      const parsed = parseA2uiMessage(trimmed);
      if (parsed) {
        this.processMessage(parsed);
      } else {
        this.handleError({
          code: 'PARSE_ERROR',
          message: `Failed to parse A2UI message: ${trimmed.slice(0, 100)}`,
        });
      }
    }
  }

  /**
   * å¤„ç† AG-UI CUSTOM äº‹ä»¶
   */
  processCustomEvent(event: { name: string; value: unknown }): boolean {
    if (!event.name.startsWith('a2ui.')) {
      return false;
    }

    const parsed = parseA2uiMessage(event.value as object);
    if (parsed) {
      this.processMessage(parsed);
      return true;
    }
    return false;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Message Handlers
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  private handleSurfaceUpdate(payload: A2uiSurfaceUpdate): void {
    const surfaceId = payload.surfaceId ?? 'default';
    const surface = this.surfaceManager.getOrCreate(surfaceId);

    for (const { id, component } of payload.components) {
      surface.components.set(id, component);
    }

    this.options.onSurfaceUpdate?.(surfaceId);
    this.notify();
  }

  private handleDataModelUpdate(payload: A2uiDataModelUpdate): void {
    const surfaceId = payload.surfaceId ?? 'default';
    const surface = this.surfaceManager.getOrCreate(surfaceId);

    surface.dataModel.update(payload.path ?? '', payload.contents);

    this.options.onSurfaceUpdate?.(surfaceId);
    this.notify();
  }

  private handleBeginRendering(payload: A2uiBeginRendering): void {
    const surfaceId = payload.surfaceId ?? 'default';
    const surface = this.surfaceManager.getOrCreate(surfaceId);

    surface.rootId = payload.root;
    surface.catalogId = payload.catalogId;
    surface.isReady = true;

    this.options.onSurfaceReady?.(surfaceId, payload.root);
    this.notify();
  }

  private handleDeleteSurface(payload: A2uiDeleteSurface): void {
    this.surfaceManager.delete(payload.surfaceId);
    this.options.onSurfaceDelete?.(payload.surfaceId);
    this.notify();
  }

  private handleError(error: A2uiEngineError): void {
    this.options.onError?.(error);
    console.warn('[A2UI Engine]', error.code, error.message);
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Surface Access
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * è·å–æŒ‡å®š Surface
   */
  getSurface(surfaceId: string = 'default'): Surface | undefined {
    return this.surfaceManager.get(surfaceId);
  }

  /**
   * è·å–æ‰€æœ‰ Surface
   */
  getAllSurfaces(): Map<string, Surface> {
    return this.surfaceManager.getAll();
  }

  /**
   * æ£€æŸ¥ Surface æ˜¯å¦å°±ç»ª
   */
  isSurfaceReady(surfaceId: string = 'default'): boolean {
    return this.surfaceManager.get(surfaceId)?.isReady ?? false;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Subscription
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * è®¢é˜…çŠ¶æ€å˜æ›´
   */
  subscribe(listener: A2uiEngineListener): () => void {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  }

  /**
   * è·å–å¿«ç…§ï¼ˆç”¨äº React useSyncExternalStoreï¼‰
   */
  getSnapshot(): Map<string, Surface> {
    return this.surfaceManager.getAll();
  }

  private notify(): void {
    this.listeners.forEach((l) => l());
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Action Handling
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * æ„å»ºç”¨æˆ·æ“ä½œæ¶ˆæ¯
   */
  buildUserAction(
    surfaceId: string,
    componentId: string,
    actionName: string,
    resolvedContext: Record<string, unknown>
  ): A2uiUserAction {
    return {
      name: actionName,
      surfaceId,
      sourceComponentId: componentId,
      timestamp: new Date().toISOString(),
      context: resolvedContext,
    };
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Cleanup
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /**
   * é‡ç½®å¼•æ“çŠ¶æ€
   */
  reset(): void {
    this.surfaceManager.clear();
    this.notify();
  }

  /**
   * é”€æ¯å¼•æ“
   */
  destroy(): void {
    this.reset();
    this.listeners.clear();
  }
}
```

### 4.2 SurfaceManager

```typescript
// packages/kit-a2ui/src/engine/SurfaceManager.ts

import { DataModelStore } from '../data/DataModelStore';
import type { A2uiComponentDefinition } from '@aevatar/kit-types';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Surface Type
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export interface Surface {
  /** Surface å”¯ä¸€æ ‡è¯† */
  id: string;
  /** ç»„ä»¶æ˜ å°„è¡¨ï¼ˆé‚»æ¥è¡¨ï¼‰ */
  components: Map<string, A2uiComponentDefinition>;
  /** æ•°æ®æ¨¡å‹å­˜å‚¨ */
  dataModel: DataModelStore;
  /** æ ¹ç»„ä»¶ ID */
  rootId: string | null;
  /** ä½¿ç”¨çš„ç»„ä»¶ç›®å½• ID */
  catalogId?: string;
  /** æ˜¯å¦å·²æ”¶åˆ° beginRendering */
  isReady: boolean;
  /** åˆ›å»ºæ—¶é—´ */
  createdAt: number;
  /** æœ€åæ›´æ–°æ—¶é—´ */
  updatedAt: number;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SurfaceManager Implementation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export class SurfaceManager {
  private surfaces = new Map<string, Surface>();

  /**
   * è·å–æˆ–åˆ›å»º Surface
   */
  getOrCreate(surfaceId: string): Surface {
    if (!this.surfaces.has(surfaceId)) {
      this.surfaces.set(surfaceId, this.createSurface(surfaceId));
    }
    const surface = this.surfaces.get(surfaceId)!;
    surface.updatedAt = Date.now();
    return surface;
  }

  /**
   * è·å– Surface
   */
  get(surfaceId: string): Surface | undefined {
    return this.surfaces.get(surfaceId);
  }

  /**
   * è·å–æ‰€æœ‰ Surface
   */
  getAll(): Map<string, Surface> {
    return new Map(this.surfaces);
  }

  /**
   * åˆ é™¤ Surface
   */
  delete(surfaceId: string): boolean {
    return this.surfaces.delete(surfaceId);
  }

  /**
   * æ¸…ç©ºæ‰€æœ‰ Surface
   */
  clear(): void {
    this.surfaces.clear();
  }

  /**
   * è·å– Surface æ•°é‡
   */
  get size(): number {
    return this.surfaces.size;
  }

  private createSurface(id: string): Surface {
    const now = Date.now();
    return {
      id,
      components: new Map(),
      dataModel: new DataModelStore(),
      rootId: null,
      catalogId: undefined,
      isReady: false,
      createdAt: now,
      updatedAt: now,
    };
  }
}
```

### 4.3 DataModelStore

```typescript
// packages/kit-a2ui/src/data/DataModelStore.ts

import type { A2uiDataEntry, A2uiBoundValue } from '@aevatar/kit-types';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DataModelStore Implementation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export class DataModelStore {
  private data: Record<string, unknown> = {};
  private version = 0;

  /**
   * æ›´æ–°æ•°æ®æ¨¡å‹
   */
  update(basePath: string, contents: A2uiDataEntry[]): void {
    const target = basePath ? this.ensurePath(basePath) : this.data;
    this.applyEntries(target as Record<string, unknown>, contents);
    this.version++;
  }

  /**
   * æ ¹æ®è·¯å¾„è·å–å€¼
   */
  get(path: string): unknown {
    if (!path || path === '/') return this.data;
    
    const keys = path.replace(/^\//, '').split('/');
    let current: unknown = this.data;
    
    for (const key of keys) {
      if (current === null || current === undefined) return undefined;
      if (typeof current !== 'object') return undefined;
      current = (current as Record<string, unknown>)[key];
    }
    
    return current;
  }

  /**
   * è§£æç»‘å®šå€¼
   */
  resolveBoundValue(boundValue: A2uiBoundValue): unknown {
    // å­—é¢å€¼ä¼˜å…ˆï¼ˆå¦‚æœæ²¡æœ‰ pathï¼‰
    if (boundValue.path === undefined) {
      if (boundValue.literalString !== undefined) return boundValue.literalString;
      if (boundValue.literalNumber !== undefined) return boundValue.literalNumber;
      if (boundValue.literalBoolean !== undefined) return boundValue.literalBoolean;
      if (boundValue.literalArray !== undefined) return boundValue.literalArray;
      return undefined;
    }

    // è·¯å¾„ç»‘å®š
    const value = this.get(boundValue.path);
    
    // å¦‚æœè·¯å¾„å€¼ä¸å­˜åœ¨ï¼Œä½¿ç”¨å­—é¢å€¼ä½œä¸ºé»˜è®¤å€¼
    if (value === undefined) {
      if (boundValue.literalString !== undefined) return boundValue.literalString;
      if (boundValue.literalNumber !== undefined) return boundValue.literalNumber;
      if (boundValue.literalBoolean !== undefined) return boundValue.literalBoolean;
      if (boundValue.literalArray !== undefined) return boundValue.literalArray;
    }
    
    return value;
  }

  /**
   * è®¾ç½®å•ä¸ªå€¼ï¼ˆç”¨äºè¡¨å•åŒå‘ç»‘å®šï¼‰
   */
  set(path: string, value: unknown): void {
    const keys = path.replace(/^\//, '').split('/');
    const lastKey = keys.pop();
    if (!lastKey) return;

    let current: Record<string, unknown> = this.data;
    for (const key of keys) {
      if (current[key] === undefined) {
        current[key] = {};
      }
      current = current[key] as Record<string, unknown>;
    }
    
    current[lastKey] = value;
    this.version++;
  }

  /**
   * è·å–å®Œæ•´æ•°æ®å‰¯æœ¬
   */
  getSnapshot(): Record<string, unknown> {
    return structuredClone(this.data);
  }

  /**
   * è·å–ç‰ˆæœ¬å·ï¼ˆç”¨äºå˜æ›´æ£€æµ‹ï¼‰
   */
  getVersion(): number {
    return this.version;
  }

  /**
   * åˆ›å»ºå¸¦ä¸Šä¸‹æ–‡çš„è§†å›¾ï¼ˆç”¨äºæ¨¡æ¿æ¸²æŸ“ï¼‰
   */
  withItemContext(item: unknown, index: number): DataModelStore {
    const contextStore = new DataModelStore();
    contextStore.data = {
      ...this.data,
      _item: item,
      _index: index,
    };
    return contextStore;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Private Methods
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  private ensurePath(path: string): Record<string, unknown> {
    const keys = path.replace(/^\//, '').split('/');
    let current: Record<string, unknown> = this.data;
    
    for (const key of keys) {
      if (current[key] === undefined) {
        current[key] = {};
      }
      current = current[key] as Record<string, unknown>;
    }
    
    return current;
  }

  private applyEntries(target: Record<string, unknown>, entries: A2uiDataEntry[]): void {
    for (const entry of entries) {
      const value = this.extractValue(entry);
      target[entry.key] = value;
    }
  }

  private extractValue(entry: A2uiDataEntry): unknown {
    if (entry.valueString !== undefined) return entry.valueString;
    if (entry.valueNumber !== undefined) return entry.valueNumber;
    if (entry.valueBoolean !== undefined) return entry.valueBoolean;
    if (entry.valueArray !== undefined) return entry.valueArray;
    if (entry.valueMap !== undefined) {
      const obj: Record<string, unknown> = {};
      this.applyEntries(obj, entry.valueMap);
      return obj;
    }
    return undefined;
  }
}
```

---

## 5. Component Layer è®¾è®¡

### 5.1 ComponentRegistry

```typescript
// packages/kit-a2ui/src/registry/ComponentRegistry.ts

import type { ComponentType } from 'react';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Types
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/**
 * A2UI ç»„ä»¶å±æ€§åŸºç¡€æ¥å£
 */
export interface A2uiComponentBaseProps {
  /** å­å…ƒç´  */
  children?: React.ReactNode;
  /** åŠ¨ä½œå›è°ƒ */
  onAction?: () => void;
  /** ç»„ä»¶ IDï¼ˆè°ƒè¯•ç”¨ï¼‰ */
  'data-a2ui-id'?: string;
}

/**
 * A2UI React ç»„ä»¶ç±»å‹
 */
export type A2uiReactComponent<P = Record<string, unknown>> = ComponentType<
  P & A2uiComponentBaseProps
>;

/**
 * ç»„ä»¶æ³¨å†Œè¡¨æ¥å£
 */
export interface ComponentRegistry {
  /** è·å–ç»„ä»¶ */
  get(type: string): A2uiReactComponent | undefined;
  /** æ³¨å†Œç»„ä»¶ */
  set(type: string, component: A2uiReactComponent): void;
  /** æ£€æŸ¥ç»„ä»¶æ˜¯å¦å­˜åœ¨ */
  has(type: string): boolean;
  /** è·å–æ‰€æœ‰å·²æ³¨å†Œç»„ä»¶ç±»å‹ */
  getTypes(): string[];
  /** åˆå¹¶å¦ä¸€ä¸ªæ³¨å†Œè¡¨ */
  merge(other: ComponentRegistry): ComponentRegistry;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Implementation
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export function createComponentRegistry(
  components: Record<string, A2uiReactComponent> = {}
): ComponentRegistry {
  const registry = new Map<string, A2uiReactComponent>(Object.entries(components));

  return {
    get(type: string) {
      return registry.get(type);
    },

    set(type: string, component: A2uiReactComponent) {
      registry.set(type, component);
    },

    has(type: string) {
      return registry.has(type);
    },

    getTypes() {
      return Array.from(registry.keys());
    },

    merge(other: ComponentRegistry) {
      const merged = createComponentRegistry();
      // å¤åˆ¶å½“å‰æ³¨å†Œè¡¨
      for (const type of this.getTypes()) {
        merged.set(type, this.get(type)!);
      }
      // åˆå¹¶å…¶ä»–æ³¨å†Œè¡¨ï¼ˆè¦†ç›–åŒåï¼‰
      for (const type of other.getTypes()) {
        merged.set(type, other.get(type)!);
      }
      return merged;
    },
  };
}

/**
 * è¾…åŠ©å‡½æ•°ï¼šæ³¨å†Œå•ä¸ªç»„ä»¶
 */
export function registerComponent(
  registry: ComponentRegistry,
  type: string,
  component: A2uiReactComponent
): void {
  registry.set(type, component);
}
```

### 5.2 Standard Catalog (Radix UI é€‚é…)

```typescript
// packages/kit-react/src/components/a2ui/catalog/standard.tsx

import React from 'react';
import { createComponentRegistry, type A2uiReactComponent } from '@aevatar/kit-a2ui';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Layout Components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const Row: A2uiReactComponent<{
  alignment?: 'start' | 'center' | 'end' | 'space-between';
  gap?: string;
}> = ({ children, alignment = 'start', gap = '8px', ...props }) => (
  <div
    style={{
      display: 'flex',
      flexDirection: 'row',
      alignItems: 'center',
      justifyContent: alignment === 'space-between' ? 'space-between' : `flex-${alignment}`,
      gap,
    }}
    {...props}
  >
    {children}
  </div>
);

const Column: A2uiReactComponent<{
  alignment?: 'start' | 'center' | 'end';
  gap?: string;
}> = ({ children, alignment = 'start', gap = '8px', ...props }) => (
  <div
    style={{
      display: 'flex',
      flexDirection: 'column',
      alignItems: alignment === 'center' ? 'center' : `flex-${alignment}`,
      gap,
    }}
    {...props}
  >
    {children}
  </div>
);

const Card: A2uiReactComponent<{
  elevation?: number;
}> = ({ children, elevation = 1, ...props }) => (
  <div
    className="a2ui-card"
    style={{
      padding: '16px',
      borderRadius: '8px',
      backgroundColor: 'var(--card-bg, #fff)',
      boxShadow: `0 ${elevation * 2}px ${elevation * 4}px rgba(0,0,0,0.1)`,
      border: '1px solid var(--card-border, #e5e5e5)',
    }}
    {...props}
  >
    {children}
  </div>
);

const List: A2uiReactComponent<{
  gap?: string;
}> = ({ children, gap = '8px', ...props }) => (
  <div
    style={{
      display: 'flex',
      flexDirection: 'column',
      gap,
    }}
    {...props}
  >
    {children}
  </div>
);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Content Components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const Text: A2uiReactComponent<{
  text?: string;
  usageHint?: 'h1' | 'h2' | 'h3' | 'h4' | 'body' | 'caption';
  color?: string;
}> = ({ text, usageHint = 'body', color, children, ...props }) => {
  const styles: React.CSSProperties = { color };
  
  switch (usageHint) {
    case 'h1':
      return <h1 style={{ ...styles, fontSize: '2rem', fontWeight: 700 }} {...props}>{text ?? children}</h1>;
    case 'h2':
      return <h2 style={{ ...styles, fontSize: '1.5rem', fontWeight: 600 }} {...props}>{text ?? children}</h2>;
    case 'h3':
      return <h3 style={{ ...styles, fontSize: '1.25rem', fontWeight: 600 }} {...props}>{text ?? children}</h3>;
    case 'h4':
      return <h4 style={{ ...styles, fontSize: '1rem', fontWeight: 600 }} {...props}>{text ?? children}</h4>;
    case 'caption':
      return <span style={{ ...styles, fontSize: '0.875rem', color: color ?? '#666' }} {...props}>{text ?? children}</span>;
    default:
      return <p style={styles} {...props}>{text ?? children}</p>;
  }
};

const Image: A2uiReactComponent<{
  url?: string;
  alt?: string;
  width?: string | number;
  height?: string | number;
  fit?: 'cover' | 'contain' | 'fill';
}> = ({ url, alt = '', width, height, fit = 'cover', ...props }) => (
  <img
    src={url}
    alt={alt}
    style={{
      width,
      height,
      objectFit: fit,
      borderRadius: '4px',
    }}
    {...props}
  />
);

const Divider: A2uiReactComponent<{
  orientation?: 'horizontal' | 'vertical';
}> = ({ orientation = 'horizontal', ...props }) => (
  <hr
    style={{
      border: 'none',
      borderTop: orientation === 'horizontal' ? '1px solid #e5e5e5' : 'none',
      borderLeft: orientation === 'vertical' ? '1px solid #e5e5e5' : 'none',
      margin: orientation === 'horizontal' ? '8px 0' : '0 8px',
      height: orientation === 'vertical' ? '100%' : 'auto',
    }}
    {...props}
  />
);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Input Components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const Button: A2uiReactComponent<{
  label?: string;
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
}> = ({ 
  children, 
  label, 
  variant = 'primary', 
  size = 'md', 
  disabled = false,
  onAction,
  ...props 
}) => {
  const sizeStyles = {
    sm: { padding: '4px 8px', fontSize: '0.875rem' },
    md: { padding: '8px 16px', fontSize: '1rem' },
    lg: { padding: '12px 24px', fontSize: '1.125rem' },
  };

  const variantStyles = {
    primary: {
      backgroundColor: 'var(--primary, #0066cc)',
      color: '#fff',
      border: 'none',
    },
    secondary: {
      backgroundColor: 'var(--secondary, #666)',
      color: '#fff',
      border: 'none',
    },
    outline: {
      backgroundColor: 'transparent',
      color: 'var(--primary, #0066cc)',
      border: '1px solid var(--primary, #0066cc)',
    },
    ghost: {
      backgroundColor: 'transparent',
      color: 'var(--text, #333)',
      border: 'none',
    },
  };

  return (
    <button
      onClick={onAction}
      disabled={disabled}
      style={{
        ...sizeStyles[size],
        ...variantStyles[variant],
        borderRadius: '6px',
        cursor: disabled ? 'not-allowed' : 'pointer',
        opacity: disabled ? 0.5 : 1,
        fontWeight: 500,
        transition: 'all 0.2s',
      }}
      {...props}
    >
      {label ?? children}
    </button>
  );
};

const TextField: A2uiReactComponent<{
  label?: string;
  placeholder?: string;
  value?: string;
  type?: 'text' | 'email' | 'password' | 'number';
  disabled?: boolean;
  onChange?: (value: string) => void;
}> = ({ 
  label, 
  placeholder, 
  value = '', 
  type = 'text',
  disabled = false,
  onChange,
  ...props 
}) => (
  <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }} {...props}>
    {label && (
      <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#333' }}>
        {label}
      </label>
    )}
    <input
      type={type}
      value={value}
      placeholder={placeholder}
      disabled={disabled}
      onChange={(e) => onChange?.(e.target.value)}
      style={{
        padding: '8px 12px',
        borderRadius: '6px',
        border: '1px solid #d1d5db',
        fontSize: '1rem',
        outline: 'none',
        transition: 'border-color 0.2s',
      }}
    />
  </div>
);

const Select: A2uiReactComponent<{
  label?: string;
  placeholder?: string;
  value?: string;
  options?: Array<{ value: string; label: string }>;
  disabled?: boolean;
  onChange?: (value: string) => void;
}> = ({ 
  label, 
  placeholder = 'è¯·é€‰æ‹©',
  value = '', 
  options = [],
  disabled = false,
  onChange,
  ...props 
}) => (
  <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }} {...props}>
    {label && (
      <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#333' }}>
        {label}
      </label>
    )}
    <select
      value={value}
      disabled={disabled}
      onChange={(e) => onChange?.(e.target.value)}
      style={{
        padding: '8px 12px',
        borderRadius: '6px',
        border: '1px solid #d1d5db',
        fontSize: '1rem',
        outline: 'none',
        backgroundColor: '#fff',
      }}
    >
      <option value="" disabled>{placeholder}</option>
      {options.map((opt) => (
        <option key={opt.value} value={opt.value}>{opt.label}</option>
      ))}
    </select>
  </div>
);

const Checkbox: A2uiReactComponent<{
  label?: string;
  checked?: boolean;
  disabled?: boolean;
  onChange?: (checked: boolean) => void;
}> = ({ label, checked = false, disabled = false, onChange, ...props }) => (
  <label 
    style={{ 
      display: 'flex', 
      alignItems: 'center', 
      gap: '8px',
      cursor: disabled ? 'not-allowed' : 'pointer',
      opacity: disabled ? 0.5 : 1,
    }} 
    {...props}
  >
    <input
      type="checkbox"
      checked={checked}
      disabled={disabled}
      onChange={(e) => onChange?.(e.target.checked)}
      style={{ width: '16px', height: '16px' }}
    />
    {label && <span style={{ fontSize: '0.875rem' }}>{label}</span>}
  </label>
);

const DateTimeInput: A2uiReactComponent<{
  label?: string;
  value?: string;
  type?: 'date' | 'time' | 'datetime-local';
  disabled?: boolean;
  onChange?: (value: string) => void;
}> = ({ 
  label, 
  value = '', 
  type = 'date',
  disabled = false,
  onChange,
  ...props 
}) => (
  <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }} {...props}>
    {label && (
      <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#333' }}>
        {label}
      </label>
    )}
    <input
      type={type}
      value={value}
      disabled={disabled}
      onChange={(e) => onChange?.(e.target.value)}
      style={{
        padding: '8px 12px',
        borderRadius: '6px',
        border: '1px solid #d1d5db',
        fontSize: '1rem',
        outline: 'none',
      }}
    />
  </div>
);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Export Standard Catalog
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export const standardCatalog = createComponentRegistry({
  // Layout
  Row,
  Column,
  Card,
  List,
  
  // Content
  Text,
  Image,
  Divider,
  
  // Input
  Button,
  TextField,
  Select,
  Checkbox,
  DateTimeInput,
});

export default standardCatalog;
```

---

## 6. Application Layer è®¾è®¡

### 6.1 React Hooks

```typescript
// packages/kit-react/src/hooks/useA2ui.ts

import { useSyncExternalStore, useCallback, useContext } from 'react';
import { A2uiContext } from '../context/A2uiContext';
import type { Surface } from '@aevatar/kit-a2ui';

/**
 * è®¿é—® A2UI å¼•æ“çš„ Hook
 */
export function useA2ui(surfaceId: string = 'default') {
  const context = useContext(A2uiContext);
  
  if (!context) {
    throw new Error('useA2ui must be used within A2uiProvider');
  }
  
  const { engine, registry, onAction } = context;

  // è®¢é˜…æŒ‡å®š Surface çš„å˜æ›´
  const surface = useSyncExternalStore(
    (callback) => engine.subscribe(callback),
    () => engine.getSurface(surfaceId),
    () => engine.getSurface(surfaceId)
  );

  // å¤„ç†ç”¨æˆ·åŠ¨ä½œ
  const handleAction = useCallback(
    (componentId: string, actionName: string, resolvedContext: Record<string, unknown>) => {
      const action = engine.buildUserAction(
        surfaceId,
        componentId,
        actionName,
        resolvedContext
      );
      onAction?.(action);
    },
    [engine, surfaceId, onAction]
  );

  return {
    /** Surface æ•°æ® */
    surface,
    /** æ˜¯å¦å·²å°±ç»ª */
    isReady: surface?.isReady ?? false,
    /** æ ¹ç»„ä»¶ ID */
    rootId: surface?.rootId ?? null,
    /** ç»„ä»¶æ³¨å†Œè¡¨ */
    registry,
    /** å¤„ç†ç”¨æˆ·åŠ¨ä½œ */
    handleAction,
    /** A2UI å¼•æ“ */
    engine,
  };
}

export type UseA2uiResult = ReturnType<typeof useA2ui>;
```

```typescript
// packages/kit-react/src/hooks/useA2uiStream.ts

import { useState, useEffect, useCallback } from 'react';
import { useA2ui, type UseA2uiResult } from './useA2ui';

export interface UseA2uiStreamOptions {
  /** Surface ID */
  surfaceId?: string;
  /** æ˜¯å¦è‡ªåŠ¨è¿æ¥ */
  autoConnect?: boolean;
  /** é‡è¯•æ¬¡æ•° */
  maxRetries?: number;
  /** é‡è¯•é—´éš” (ms) */
  retryDelay?: number;
}

export type StreamStatus = 'idle' | 'connecting' | 'connected' | 'error' | 'closed';

export interface UseA2uiStreamResult extends UseA2uiResult {
  /** è¿æ¥çŠ¶æ€ */
  status: StreamStatus;
  /** é”™è¯¯ä¿¡æ¯ */
  error: Error | null;
  /** æ‰‹åŠ¨è¿æ¥ */
  connect: () => void;
  /** æ‰‹åŠ¨æ–­å¼€ */
  disconnect: () => void;
}

/**
 * è¿æ¥ A2UI SSE æµçš„ Hook
 */
export function useA2uiStream(
  url: string | null,
  options: UseA2uiStreamOptions = {}
): UseA2uiStreamResult {
  const {
    surfaceId = 'default',
    autoConnect = true,
    maxRetries = 3,
    retryDelay = 1000,
  } = options;

  const a2ui = useA2ui(surfaceId);
  const [status, setStatus] = useState<StreamStatus>('idle');
  const [error, setError] = useState<Error | null>(null);
  const [eventSource, setEventSource] = useState<EventSource | null>(null);
  const [retryCount, setRetryCount] = useState(0);

  const connect = useCallback(() => {
    if (!url) return;
    
    setStatus('connecting');
    setError(null);

    const es = new EventSource(url);

    es.onopen = () => {
      setStatus('connected');
      setRetryCount(0);
    };

    es.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        
        // å¤„ç† AG-UI CUSTOM äº‹ä»¶
        if (data.type === 'CUSTOM' && data.name?.startsWith('a2ui.')) {
          a2ui.engine.processCustomEvent(data);
        } else {
          // ç›´æ¥ A2UI æ¶ˆæ¯
          a2ui.engine.processJsonl(event.data);
        }
      } catch (e) {
        console.warn('[A2UI Stream] Parse error:', e);
      }
    };

    es.onerror = () => {
      es.close();
      setStatus('error');
      
      // è‡ªåŠ¨é‡è¯•
      if (retryCount < maxRetries) {
        setTimeout(() => {
          setRetryCount((c) => c + 1);
          connect();
        }, retryDelay * (retryCount + 1));
      } else {
        setError(new Error('SSE connection failed after max retries'));
      }
    };

    setEventSource(es);

    return () => {
      es.close();
      setStatus('closed');
    };
  }, [url, a2ui.engine, retryCount, maxRetries, retryDelay]);

  const disconnect = useCallback(() => {
    eventSource?.close();
    setEventSource(null);
    setStatus('closed');
  }, [eventSource]);

  // è‡ªåŠ¨è¿æ¥
  useEffect(() => {
    if (autoConnect && url) {
      const cleanup = connect();
      return cleanup;
    }
  }, [autoConnect, url, connect]);

  // ç»„ä»¶å¸è½½æ—¶æ–­å¼€
  useEffect(() => {
    return () => {
      eventSource?.close();
    };
  }, [eventSource]);

  return {
    ...a2ui,
    status,
    error,
    connect,
    disconnect,
  };
}
```

### 6.2 A2uiProvider

```typescript
// packages/kit-react/src/context/A2uiContext.ts

import { createContext } from 'react';
import type { A2uiEngine, ComponentRegistry, A2uiUserAction } from '@aevatar/kit-a2ui';

export interface A2uiContextValue {
  /** A2UI å¼•æ“å®ä¾‹ */
  engine: A2uiEngine;
  /** ç»„ä»¶æ³¨å†Œè¡¨ */
  registry: ComponentRegistry;
  /** ç”¨æˆ·åŠ¨ä½œå›è°ƒ */
  onAction?: (action: A2uiUserAction) => void;
}

export const A2uiContext = createContext<A2uiContextValue | null>(null);
```

```typescript
// packages/kit-react/src/components/a2ui/A2uiProvider.tsx

import React, { useMemo, useRef, useEffect } from 'react';
import { A2uiEngine, type ComponentRegistry, type A2uiUserAction } from '@aevatar/kit-a2ui';
import { A2uiContext, type A2uiContextValue } from '../../context/A2uiContext';
import { standardCatalog } from './catalog/standard';

export interface A2uiProviderProps {
  children: React.ReactNode;
  /** è‡ªå®šä¹‰ç»„ä»¶æ³¨å†Œè¡¨ï¼ˆä¸æ ‡å‡†ç›®å½•åˆå¹¶ï¼‰ */
  registry?: ComponentRegistry;
  /** ç”¨æˆ·åŠ¨ä½œå¤„ç† */
  onAction?: (action: A2uiUserAction) => void;
  /** æ˜¯å¦ä½¿ç”¨æ ‡å‡†ç»„ä»¶ç›®å½• */
  useStandardCatalog?: boolean;
}

export function A2uiProvider({
  children,
  registry: customRegistry,
  onAction,
  useStandardCatalog = true,
}: A2uiProviderProps) {
  // åˆ›å»ºå¼•æ“å®ä¾‹ï¼ˆå•ä¾‹ï¼‰
  const engineRef = useRef<A2uiEngine>();
  if (!engineRef.current) {
    engineRef.current = new A2uiEngine({
      onError: (err) => console.error('[A2UI]', err.code, err.message),
    });
  }

  // åˆå¹¶ç»„ä»¶æ³¨å†Œè¡¨
  const registry = useMemo(() => {
    const base = useStandardCatalog ? standardCatalog : createComponentRegistry();
    return customRegistry ? base.merge(customRegistry) : base;
  }, [customRegistry, useStandardCatalog]);

  // æ¸…ç†
  useEffect(() => {
    return () => {
      engineRef.current?.destroy();
    };
  }, []);

  const contextValue = useMemo<A2uiContextValue>(
    () => ({
      engine: engineRef.current!,
      registry,
      onAction,
    }),
    [registry, onAction]
  );

  return (
    <A2uiContext.Provider value={contextValue}>
      {children}
    </A2uiContext.Provider>
  );
}
```

### 6.3 A2uiSurface ç»„ä»¶

```typescript
// packages/kit-react/src/components/a2ui/A2uiSurface.tsx

import React from 'react';
import { useA2ui } from '../../hooks/useA2ui';
import { A2uiComponentRenderer } from './A2uiComponentRenderer';

export interface A2uiSurfaceProps {
  /** Surface ID */
  surfaceId?: string;
  /** å®¹å™¨ className */
  className?: string;
  /** å®¹å™¨ style */
  style?: React.CSSProperties;
  /** åŠ è½½ä¸­å ä½ */
  loadingFallback?: React.ReactNode;
  /** ç©ºçŠ¶æ€å ä½ */
  emptyFallback?: React.ReactNode;
}

export function A2uiSurface({
  surfaceId = 'default',
  className,
  style,
  loadingFallback = <div>Loading...</div>,
  emptyFallback = null,
}: A2uiSurfaceProps) {
  const { surface, isReady, rootId, registry, handleAction } = useA2ui(surfaceId);

  // æœªå°±ç»ª
  if (!isReady) {
    return <>{loadingFallback}</>;
  }

  // æ— æ ¹ç»„ä»¶
  if (!rootId || !surface) {
    return <>{emptyFallback}</>;
  }

  return (
    <div
      className={className}
      style={style}
      data-a2ui-surface={surfaceId}
    >
      <A2uiComponentRenderer
        componentId={rootId}
        components={surface.components}
        dataModel={surface.dataModel}
        registry={registry}
        onAction={handleAction}
      />
    </div>
  );
}
```

---

## 7. API Reference

### 7.1 Package Exports

```typescript
// @aevatar/kit-a2ui
export { A2uiEngine, type A2uiEngineOptions, type A2uiEngineError } from './engine';
export { SurfaceManager, type Surface } from './engine';
export { DataModelStore } from './data';
export { parseA2uiMessage, parseA2uiJsonl, A2UI_EVENT_NAMES } from './parser';
export { createComponentRegistry, type ComponentRegistry, type A2uiReactComponent } from './registry';

// @aevatar/kit-react (A2UI éƒ¨åˆ†)
export { A2uiProvider, type A2uiProviderProps } from './components/a2ui';
export { A2uiSurface, type A2uiSurfaceProps } from './components/a2ui';
export { A2uiComponentRenderer } from './components/a2ui';
export { useA2ui, type UseA2uiResult } from './hooks';
export { useA2uiStream, type UseA2uiStreamResult, type StreamStatus } from './hooks';
export { standardCatalog } from './components/a2ui/catalog';
export { A2uiContext, type A2uiContextValue } from './context';

// @aevatar/kit-types (A2UI éƒ¨åˆ†)
export type {
  A2uiServerMessage,
  A2uiClientMessage,
  A2uiSurfaceUpdate,
  A2uiDataModelUpdate,
  A2uiBeginRendering,
  A2uiDeleteSurface,
  A2uiComponentInstance,
  A2uiComponentDefinition,
  A2uiBoundValue,
  A2uiChildren,
  A2uiAction,
  A2uiUserAction,
  A2uiClientError,
} from './a2ui';
```

### 7.2 Quick Start

```tsx
import { A2uiProvider, A2uiSurface, useA2uiStream } from '@aevatar/kit-react';

function App() {
  return (
    <A2uiProvider
      onAction={(action) => {
        // å‘é€ç”¨æˆ·åŠ¨ä½œåˆ°åç«¯
        fetch('/api/a2ui/action', {
          method: 'POST',
          body: JSON.stringify({ userAction: action }),
        });
      }}
    >
      <MyAgentUI />
    </A2uiProvider>
  );
}

function MyAgentUI() {
  const { isReady, status, error } = useA2uiStream('/api/agent/stream');

  if (status === 'connecting') return <div>è¿æ¥ä¸­...</div>;
  if (error) return <div>é”™è¯¯: {error.message}</div>;
  if (!isReady) return <div>ç­‰å¾… Agent å“åº”...</div>;

  return <A2uiSurface className="p-4" />;
}
```

---

## 8. æµ‹è¯•ç­–ç•¥

### 8.1 å•å…ƒæµ‹è¯•

| æ¨¡å— | æµ‹è¯•é‡ç‚¹ | è¦†ç›–ç‡ç›®æ ‡ |
|------|----------|-----------|
| MessageParser | å„æ¶ˆæ¯ç±»å‹è§£æã€è¾¹ç•Œæƒ…å†µ | 95% |
| DataModelStore | è·¯å¾„æ“ä½œã€ç»‘å®šè§£æ | 90% |
| A2uiEngine | æ¶ˆæ¯å¤„ç†ã€çŠ¶æ€ç®¡ç† | 90% |
| ComponentRegistry | æ³¨å†Œ/è·å–/åˆå¹¶ | 95% |

### 8.2 é›†æˆæµ‹è¯•

| åœºæ™¯ | æè¿° |
|------|------|
| å®Œæ•´æ¸²æŸ“æµç¨‹ | surfaceUpdate â†’ dataModelUpdate â†’ beginRendering |
| åŠ¨æ€åˆ—è¡¨ | template æ¸²æŸ“ + æ•°æ®ç»‘å®š |
| ç”¨æˆ·äº¤äº’ | action â†’ userAction ä¸ŠæŠ¥ |
| SSE é‡è¿ | æ–­çº¿é‡è¿ + çŠ¶æ€æ¢å¤ |

---

## 9. äº¤ä»˜ç‰©æ¸…å•

| é˜¶æ®µ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|------|--------|------|
| Phase 1 | kit-types A2UI ç±»å‹å®šä¹‰ | ğŸ”² |
| Phase 1 | kit-protocol A2UI è§£æå™¨ | ğŸ”² |
| Phase 2 | kit-a2ui æ ¸å¿ƒåŒ… | ğŸ”² |
| Phase 3 | kit-react A2UI ç»„ä»¶ | ğŸ”² |
| Phase 3 | Standard Catalog | ğŸ”² |
| Phase 4 | æ–‡æ¡£ + ç¤ºä¾‹ | ğŸ”² |

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*
*è®¾è®¡æ—¥æœŸ: 2025-12-25*

